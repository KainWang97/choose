<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Choose é›»å•†å¾Œç«¯å°ˆæ¡ˆæ¶æ§‹èªªæ˜</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css"
    />
    <style>
      :root {
        --primary-blue: #3d3d3d;
        --primary-hover: #2a2a2a;
        --bg-color: #f5f5f7;
        --text-primary: #1d1d1f;
        --text-secondary: #6e6e73;
        color-scheme: light;
      }
      html {
        scroll-behavior: smooth;
      }
      body {
        background-color: var(--bg-color);
        margin: 0;
        padding-top: 80px;
        font-family: "SF Pro TC", "SF Pro Text", "PingFang TC", -apple-system,
          BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", Roboto, sans-serif;
        color: var(--text-primary);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      .author {
        font-size: 0.85rem;
        color: #64748b;
        margin-bottom: 25px;
        text-align: center;
      }
      .top-nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 75px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(15px);
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 40px;
        z-index: 2000;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 700;
        font-size: 1.35rem;
        color: #0f172a;
      }
      .logo-icon {
        width: 38px;
        height: 38px;
        background: var(--primary-blue);
        border-radius: 2px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto 80px;
        background: white;
        padding: 60px 80px;
        border-radius: 24px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .markdown-body {
        font-size: 16px;
        line-height: 1.8;
        color: #1f2328 !important;
        background-color: transparent !important;
      }
      .markdown-body code:not(pre code) {
        background-color: rgba(175, 184, 193, 0.2) !important;
        color: #0550ae !important;
        padding: 0.2em 0.4em;
        border-radius: 6px;
        font-family: "JetBrains Mono", monospace;
      }
      .markdown-body pre {
        background-color: #f6f8fa !important;
        border-radius: 12px;
        padding: 16px;
        overflow-x: auto;
      }
      .diagram-box {
        margin: 40px 0;
        border: 1px solid #f1f5f9;
        border-radius: 16px;
        background: #fafafa;
        padding: 30px;
      }
      .diagram-title {
        text-align: center;
        color: #64748b;
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 25px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }
      .mermaid {
        display: flex;
        justify-content: center;
        min-height: 50px;
      }
      .btn-export {
        background: var(--primary-blue);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      .btn-export:hover {
        background: var(--primary-hover);
      }
      /* Back to Top Button */
      .back-to-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 44px;
        height: 44px;
        background: var(--primary-blue);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        opacity: 0;
        visibility: hidden;
        transition: all 0.2s ease;
        z-index: 1500;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .back-to-top:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .back-to-top.visible {
        opacity: 1;
        visibility: visible;
      }
      /* Table of Contents Styling */
      .toc {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 16px;
        padding: 24px 32px;
        margin-bottom: 40px;
      }
      .toc-title {
        font-weight: 700;
        font-size: 1.1rem;
        color: #0f172a;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px 24px;
      }
      .toc-list li a {
        color: #475569;
        text-decoration: none;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 0;
        transition: color 0.2s;
      }
      .toc-list li a:hover {
        color: var(--primary-blue);
      }
      .toc-list li a::before {
        content: "â†’";
        color: var(--primary-blue);
        font-weight: 600;
      }
      #loading {
        position: fixed;
        inset: 0;
        background: white;
        z-index: 3000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      @media print {
        body {
          padding-top: 0;
        }
        .top-nav,
        #loading,
        .toc,
        .back-to-top {
          display: none !important;
        }
        .container {
          box-shadow: none;
          margin: 0;
          padding: 20px;
          max-width: 100%;
        }
        .diagram-box {
          page-break-inside: avoid;
          border: none;
        }
      }
    </style>
  </head>
  <body>
    <div id="loading">
      <div class="spinner"></div>
      <p style="margin-top: 25px; color: #64748b; font-weight: 600">
        æ·±åº¦æ¶æ§‹é©—è­‰å¼•æ“å•Ÿå‹•ä¸­...
      </p>
    </div>

    <header class="top-nav">
      <div class="logo">
        <div class="logo-icon">C</div>
        <span>Choose Backend Architecture >Verified 8.0</span>
      </div>
      <button class="btn-export" onclick="window.print()">
        åŒ¯å‡ºæˆæœ (PDF)
      </button>
    </header>

    <div class="container">
      <article class="markdown-body">
        <h1>æ¶æ§‹èˆ‡æŠ€è¡“å¯¦ä½œ</h1>
        <p class="author">æ–‡ä»¶ç”± Kain W. ç›£è£½ã€‚</p>

        <!-- TABLE OF CONTENTS -->
        <nav class="toc">
          <div class="toc-title">ğŸ“‘ å¿«é€Ÿå°èˆªç›®éŒ„</div>
          <ul class="toc-list">
            <li><a href="#sec-directory">1. å®Œæ•´å°ˆæ¡ˆç›®éŒ„çµæ§‹</a></li>
            <li><a href="#sec-build">1.5 å»ºç½®å·¥å…·èˆ‡å¥—ä»¶ä¾è³´</a></li>
            <li><a href="#sec-architecture">2. ç³»çµ±åˆ†å±¤æ¶æ§‹åœ–</a></li>
            <li><a href="#sec-controller">3.1 Controller å±¤è©³è§£</a></li>
            <li><a href="#sec-service">3.2 Service å±¤è©³è§£</a></li>
            <li><a href="#sec-repository">3.3 Repository å±¤è©³è§£</a></li>
            <li><a href="#sec-model">3.4 Model å±¤è©³è§£</a></li>
            <li><a href="#sec-config">3.5 Config å±¤è©³è§£</a></li>
            <li><a href="#sec-security">3.6 Security å±¤è©³è§£</a></li>
            <li><a href="#sec-dto">3.7 DTO å±¤è©³è§£</a></li>
            <li><a href="#sec-common">3.8 Common å±¤è©³è§£</a></li>
            <li><a href="#sec-annotation">4. æ ¸å¿ƒ Annotation è§£æ</a></li>
            <li><a href="#sec-auth-flow">5. JWT èªè­‰æµç¨‹åœ–</a></li>
            <li><a href="#sec-order-flow">6. è¨‚å–®å»ºç«‹æ™‚åºåœ–</a></li>
            <li><a href="#sec-summary">7. å°ˆæ¡ˆçµ±è¨ˆæ‘˜è¦</a></li>
            <li><a href="#sec-controller-detail">8. Controller æ–¹æ³•è©³è§£</a></li>
            <li><a href="#sec-service-detail">9. Service æ–¹æ³•è©³è§£</a></li>
            <li>
              <a href="#sec-repository-detail">10. Repository æ–¹æ³•è©³è§£</a>
            </li>
            <li><a href="#sec-model-detail">11. Model è¨­è¨ˆè©³è§£</a></li>
            <li><a href="#sec-dto-detail">12. DTO è½‰æ›è©³è§£</a></li>
            <li><a href="#sec-config-detail">13. Config é…ç½®è©³è§£</a></li>
            <li><a href="#sec-security-detail">14. Security å®‰å…¨è©³è§£</a></li>
            <li><a href="#sec-common-detail">15. Common å…±ç”¨è©³è§£</a></li>
            <li><a href="#sec-collaboration">16. å±¤ç´šå”ä½œé—œä¿‚åœ–</a></li>
          </ul>
        </nav>

        <hr />

        <h2 id="sec-directory">1. å®Œæ•´å°ˆæ¡ˆç›®éŒ„çµæ§‹ (Directory Tree)</h2>
        <p>åŸºåº•è·¯å¾‘ï¼š<code>backend/src/main/java/com/choose/</code></p>
        <pre><code>com.choose/
â”œâ”€â”€ BackendApplication.java         # Spring Boot å•Ÿå‹•å…¥å£ (@SpringBootApplication)
â”œâ”€â”€ ServletInitializer.java         # WAR éƒ¨ç½²æ”¯æ´ (extends SpringBootServletInitializer)
â”‚
â”œâ”€â”€ common/                         # æ©«åˆ‡é—œæ³¨é» (2 å€‹)
â”‚   â”œâ”€â”€ ApiResponse.java            # çµ±ä¸€å›æ‡‰å°è£ {success, message, data}
â”‚   â””â”€â”€ GlobalExceptionHandler.java # å…¨åŸŸä¾‹å¤–è™•ç† (8 ç¨®ä¾‹å¤–é¡å‹)
â”‚
â”œâ”€â”€ config/                         # é…ç½®æ¨¡çµ„ (5 å€‹)
â”‚   â”œâ”€â”€ CloudinaryConfig.java       # Cloudinary SDK åˆå§‹åŒ–
â”‚   â”œâ”€â”€ DataInitializer.java        # å•Ÿå‹•æ™‚å»ºç«‹é è¨­ Admin (admin@choose.com / 123456)
â”‚   â”œâ”€â”€ PasswordConfig.java         # BCryptPasswordEncoder Bean
â”‚   â”œâ”€â”€ SecurityConfig.java         # Spring Securityã€CORSã€JWT Filter è¨»å†Š
â”‚   â””â”€â”€ WebConfig.java              # Spring MVC æ“´å…… (ç›®å‰ç©ºï¼ŒCORS å·²ç§»è‡³ Security)
â”‚
â”œâ”€â”€ controller/                     # è¡¨ç¾å±¤ (9 å€‹)
â”‚   â”œâ”€â”€ AuthController.java         # /api/auth - è¨»å†Šã€ç™»å…¥ã€ç™»å‡ºã€JWT Cookie
â”‚   â”œâ”€â”€ CartController.java         # /api/cart - è³¼ç‰©è»Š CRUD
â”‚   â”œâ”€â”€ CategoryController.java     # /api/categories - åˆ†é¡ç®¡ç† (Admin)
â”‚   â”œâ”€â”€ InquiryController.java      # /api/inquiries - å®¢æœç•™è¨€
â”‚   â”œâ”€â”€ OrderController.java        # /api/orders - è¨‚å–®å»ºç«‹ã€ç‹€æ…‹æ›´æ–°
â”‚   â”œâ”€â”€ ProductController.java      # /api/products - å•†å“ CRUDã€ç²¾é¸åˆ‡æ›
â”‚   â”œâ”€â”€ ProductVariantController.java  # /api/variants - è¦æ ¼ (SKU) ç®¡ç†
â”‚   â”œâ”€â”€ UploadController.java       # /api/upload - åœ–ç‰‡ä¸Šå‚³è‡³ Cloudinary
â”‚   â””â”€â”€ UserController.java         # /api/users - å€‹è³‡ã€å¯†ç¢¼è®Šæ›´ã€å¸³è™Ÿåˆªé™¤
â”‚
â”œâ”€â”€ dto/response/                   # å›æ‡‰ DTO (6 å€‹)
â”‚   â”œâ”€â”€ CartItemDTO.java
â”‚   â”œâ”€â”€ CategoryDTO.java
â”‚   â”œâ”€â”€ InquiryDTO.java
â”‚   â”œâ”€â”€ OrderDTO.java               # å«å·¢ç‹€ OrderItemDTO
â”‚   â”œâ”€â”€ ProductDTO.java             # 11 æ¬„ä½ï¼Œå« categoryIdã€èšåˆåº«å­˜
â”‚   â””â”€â”€ ProductVariantDTO.java
â”‚
â”œâ”€â”€ model/                          # é ˜åŸŸå¯¦é«” (8 å€‹ POJO)
â”‚   â”œâ”€â”€ CartItem.java
â”‚   â”œâ”€â”€ Category.java
â”‚   â”œâ”€â”€ ContactMessage.java
â”‚   â”œâ”€â”€ Order.java                  # Enum: PENDING/PAID/SHIPPED/COMPLETED/CANCELLED
â”‚   â”œâ”€â”€ OrderItem.java
â”‚   â”œâ”€â”€ Product.java                # 3 ç´¢å¼•ã€orphanRemoval
â”‚   â”œâ”€â”€ ProductVariant.java         # UniqueConstraint(product,color,size)ã€stock ç´¢å¼•
â”‚   â””â”€â”€ User.java                   # Enum: MEMBER/ADMINã€è»Ÿåˆªé™¤
â”‚
â”œâ”€â”€ repository/                     # æŒä¹…å±¤ (7 å€‹)
â”‚   â”œâ”€â”€ CartItemRepository.java     # deleteByUserUserId()
â”‚   â”œâ”€â”€ CategoryRepository.java     # existsByName()
â”‚   â”œâ”€â”€ ContactMessageRepository.java
â”‚   â”œâ”€â”€ OrderRepository.java        # 5 æ–¹æ³•ï¼Œå« existsByUserUserIdAndStatusIn()
â”‚   â”œâ”€â”€ ProductRepository.java      # 5 æ–¹æ³•ï¼Œå« JPQL searchProducts()
â”‚   â”œâ”€â”€ ProductVariantRepository.java  # findByProductProductId()
â”‚   â””â”€â”€ UserRepository.java         # findByEmail(), existsByEmail()
â”‚
â”œâ”€â”€ security/                       # å®‰å…¨æ¨¡çµ„ (2 å€‹)
â”‚   â”œâ”€â”€ JwtAuthenticationFilter.java  # é›™è·¯å¾‘ Token æå– (Cookie / Header)
â”‚   â””â”€â”€ JwtUtil.java                # HMAC-SHA256 ç°½ç« ã€Claims è§£æ
â”‚
â””â”€â”€ service/                        # æ¥­å‹™å±¤ (7 å€‹)
    â”œâ”€â”€ CartService.java            # åº«å­˜æª¢æŸ¥ã€æ•¸é‡åˆä½µ
    â”œâ”€â”€ CategoryService.java
    â”œâ”€â”€ ContactMessageService.java  # markAsRead(), markAsReplied(), markAsUnreplied()
    â”œâ”€â”€ ImageUploadService.java     # Cloudinary upload (é™ jpg/png/gif/webp)
    â”œâ”€â”€ OrderService.java           # @Transactional åŸå­åŒ–ä¸‹å–®ã€åº«å­˜æ‰£æ¸›
    â”œâ”€â”€ ProductService.java         # SKU ç”Ÿæˆã€ç²¾é¸ä¸Šé™ 8 ä»¶
    â””â”€â”€ UserService.java            # BCrypt åŠ å¯†ã€è»Ÿåˆªé™¤å»è­˜åˆ¥åŒ–
</code></pre>

        <hr />

        <h2 id="sec-build">1.5 å»ºç½®å·¥å…·èˆ‡å¥—ä»¶ä¾è³´</h2>
        <p><strong>å»ºç½®å·¥å…·</strong>ï¼šGradle</p>
        <p><strong>Java ç‰ˆæœ¬</strong>ï¼š17</p>
        <p><strong>Spring Boot ç‰ˆæœ¬</strong>ï¼š4.0.0</p>

        <h3>æ ¸å¿ƒä¾è³´</h3>
        <table>
          <thead>
            <tr>
              <th>é¡åˆ¥</th>
              <th>å¥—ä»¶åç¨±</th>
              <th>ç‰ˆæœ¬</th>
              <th>ç”¨é€”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Web</td>
              <td><code>spring-boot-starter-web</code></td>
              <td>4.0.0</td>
              <td>REST APIã€Tomcat å…§åµŒä¼ºæœå™¨</td>
            </tr>
            <tr>
              <td>è³‡æ–™å±¤</td>
              <td><code>spring-boot-starter-data-jpa</code></td>
              <td>4.0.0</td>
              <td>JPA/Hibernate ORM</td>
            </tr>
            <tr>
              <td>å®‰å…¨</td>
              <td><code>spring-boot-starter-security</code></td>
              <td>4.0.0</td>
              <td>èªè­‰æˆæ¬Šã€CORSã€CSRF é˜²è­·</td>
            </tr>
            <tr>
              <td>é©—è­‰</td>
              <td><code>spring-boot-starter-validation</code></td>
              <td>4.0.0</td>
              <td>Bean Validation (@Valid)</td>
            </tr>
            <tr>
              <td>JWT</td>
              <td><code>io.jsonwebtoken:jjwt-api</code></td>
              <td>0.12.3</td>
              <td>HMAC-SHA256 Token ç°½ç™¼èˆ‡é©—è­‰</td>
            </tr>
            <tr>
              <td>åœ–ç‰‡å„²å­˜</td>
              <td><code>com.cloudinary:cloudinary-http5</code></td>
              <td>2.3.2</td>
              <td>Cloudinary åœ–ç‰‡ä¸Šå‚³ SDK</td>
            </tr>
            <tr>
              <td>è³‡æ–™åº«</td>
              <td><code>mysql-connector-j</code></td>
              <td>-</td>
              <td>MySQL JDBC é©…å‹•</td>
            </tr>
            <tr>
              <td>å·¥å…·</td>
              <td><code>org.projectlombok:lombok</code></td>
              <td>1.18.34</td>
              <td>æ¸›å°‘æ¨£æ¿ç¨‹å¼ç¢¼ (@Data, @RequiredArgsConstructor)</td>
            </tr>
            <tr>
              <td>æ–‡æª”</td>
              <td><code>springdoc-openapi-starter-webmvc-ui</code></td>
              <td>3.0.0</td>
              <td>Swagger UI è‡ªå‹•ç”Ÿæˆ API æ–‡æª”</td>
            </tr>
            <tr>
              <td>ç›£æ§</td>
              <td><code>spring-boot-starter-actuator</code></td>
              <td>4.0.0</td>
              <td>å¥åº·æª¢æŸ¥ã€æ‡‰ç”¨ç¨‹å¼æŒ‡æ¨™</td>
            </tr>
          </tbody>
        </table>

        <hr />

        <h2 id="sec-architecture">2. ç³»çµ±åˆ†å±¤æ¶æ§‹åœ– (Layered Architecture)</h2>
        <div class="diagram-box">
          <div class="diagram-title">è«‹æ±‚ç”Ÿå‘½é€±æœŸèˆ‡å„å±¤è·è²¬</div>
          <div class="mermaid" id="diagram-layered"></div>
        </div>

        <hr />

        <h2>3. å„å±¤æŠ€è¡“å¯¦ä½œæ·±åº¦è§£æ</h2>

        <h3 id="sec-controller">3.1 Controller å±¤ (è¡¨ç¾å±¤) - 9 å€‹æ§åˆ¶å™¨</h3>
        <p>
          <strong>è·è²¬</strong>ï¼šæ¥æ”¶ HTTP è«‹æ±‚ã€Bean Validationã€èª¿ç”¨
          Serviceã€çµ„è£ ApiResponseã€‚<strong>ç¦æ­¢åŒ…å«æ¥­å‹™é‚è¼¯</strong>ã€‚
        </p>
        <table>
          <thead>
            <tr>
              <th>æ§åˆ¶å™¨</th>
              <th>è·¯ç”±</th>
              <th>æ–¹æ³•æ•¸</th>
              <th>æŠ€è¡“äº®é»</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>AuthController</code></td>
              <td>/api/auth</td>
              <td>4</td>
              <td>
                JWT é›™è»Œç™¼æ”¾ï¼ˆHttpOnly Cookie + Response Bodyï¼‰ã€<code
                  >@Value</code
                >
                è®€å–éæœŸæ™‚é–“
              </td>
            </tr>
            <tr>
              <td><code>CartController</code></td>
              <td>/api/cart</td>
              <td>5</td>
              <td>
                <code>@AuthenticationPrincipal</code> æ³¨å…¥ Userã€å·¢ç‹€ Request
                DTO
              </td>
            </tr>
            <tr>
              <td><code>CategoryController</code></td>
              <td>/api/categories</td>
              <td>5</td>
              <td>
                <code>@PreAuthorize("hasRole('ADMIN')")</code> ä¿è­·å¯«å…¥æ“ä½œ
              </td>
            </tr>
            <tr>
              <td><code>InquiryController</code></td>
              <td>/api/inquiries</td>
              <td>7</td>
              <td>
                æ“·å– <code>X-Forwarded-For</code> å–å¾—çœŸå¯¦
                IPã€æ”¯æ´å–æ¶ˆå·²å›è¦†ç‹€æ…‹
              </td>
            </tr>
            <tr>
              <td><code>OrderController</code></td>
              <td>/api/orders</td>
              <td>7</td>
              <td>POST æ™‚ Service å…§éƒ¨åŸ·è¡Œåº«å­˜æ‰£æ¸›ã€PATCH ä»˜æ¬¾å‚™è¨»</td>
            </tr>
            <tr>
              <td><code>ProductController</code></td>
              <td>/api/products</td>
              <td>13</td>
              <td>
                /admin/all åˆ—å‡ºå…¨éƒ¨ï¼ˆå«æœªä¸Šæ¶ï¼‰ã€/featured ç²¾é¸ã€CRUDã€åº«å­˜æ›´æ–°
              </td>
            </tr>
            <tr>
              <td><code>ProductVariantController</code></td>
              <td>/api/variants</td>
              <td>5</td>
              <td>SKU è‡ªå‹•ç”Ÿæˆç”± Service è™•ç†ã€è¦æ ¼ CRUD + åº«å­˜æ›´æ–°</td>
            </tr>
            <tr>
              <td><code>UploadController</code></td>
              <td>/api/upload</td>
              <td>1</td>
              <td>
                <code>@RequestParam("file") MultipartFile</code>ã€Cloudinary SDK
              </td>
            </tr>
            <tr>
              <td><code>UserController</code></td>
              <td>/api/users</td>
              <td>6</td>
              <td>å¸³è™Ÿåˆªé™¤ä½¿ç”¨ POST (æ”¯æ´ Request Body)</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size: 0.85rem; color: #64748b; margin-top: 12px">
          ğŸ“Œ <strong>å‚™è¨»</strong>ï¼šæ–¹æ³•æ•¸åƒ…çµ±è¨ˆã€Œå…¬é–‹ API
          Endpointã€ï¼Œä¸å«å…§éƒ¨ç§æœ‰è¼”åŠ©æ–¹æ³•ï¼ˆå¦‚
          <code>createAuthCookie()</code>ã€<code>getClientIpAddress()</code>
          ç­‰ï¼‰ã€‚å¯¦éš›ç¨‹å¼ç¢¼ä¸­ AuthController æœ‰ 6 å€‹æ–¹æ³•ï¼ˆå« 2
          å€‹ç§æœ‰ï¼‰ã€InquiryController æœ‰ 7 å€‹ï¼ˆå« 1 å€‹ç§æœ‰ï¼‰ã€‚
        </p>

        <h3 id="sec-service">3.2 Service å±¤ (æ¥­å‹™é‚è¼¯å±¤) - 7 å€‹æœå‹™</h3>
        <p>
          <strong>è·è²¬</strong>ï¼šå°è£æ¥­å‹™è¦å‰‡ã€<code>@Transactional</code>
          äº¤æ˜“ç®¡ç†ã€è·¨ Repository å”èª¿ã€‚
        </p>
        <table>
          <thead>
            <tr>
              <th>æœå‹™</th>
              <th>é—œéµæ–¹æ³•</th>
              <th>å•†æ¥­é‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>UserService</code></td>
              <td>
                <code>register()</code>, <code>deleteUserAccount()</code>,
                <code>changePassword()</code>
              </td>
              <td>
                BCrypt åŠ å¯†ï¼›åˆªé™¤æ™‚æª¢æŸ¥æ´»èºè¨‚å–® â†’ å»è­˜åˆ¥åŒ–ï¼ˆUUID æ›¿æ› Emailï¼‰â†’
                æ¸…ç©ºè³¼ç‰©è»Š â†’ è»Ÿåˆªé™¤
              </td>
            </tr>
            <tr>
              <td><code>ProductService</code></td>
              <td>
                <code>toggleFeatured()</code>, <code>createVariant()</code>
              </td>
              <td>
                ç²¾é¸ä¸Šé™ 8 ä»¶ï¼ˆcountByIsFeaturedTrueï¼‰ï¼›SKU =
                <code>P{id}-{COLOR}-{SIZE}-{random}</code>
              </td>
            </tr>
            <tr>
              <td><code>OrderService</code></td>
              <td>
                <code>createOrder()</code>, <code>hasActiveOrders()</code>
              </td>
              <td>
                <strong>@Transactional</strong>ï¼šå–å‡º Variant â†’ é©—è­‰åº«å­˜ â†’ æ‰£æ¸›
                â†’ å­˜è¨‚å–®ã€‚Rollback on Exception
              </td>
            </tr>
            <tr>
              <td><code>CartService</code></td>
              <td><code>addToCart()</code>, <code>updateQuantity()</code></td>
              <td>æ–°å¢æ™‚è‹¥å·²å­˜åœ¨å‰‡åˆä½µæ•¸é‡ï¼›æ›´æ–°æ™‚é©—è­‰åº«å­˜</td>
            </tr>
            <tr>
              <td><code>ImageUploadService</code></td>
              <td><code>uploadImage()</code></td>
              <td>
                æª¢æŸ¥ MIME é¡å‹ï¼ˆimage/jpeg|png|gif|webpï¼‰â†’ Cloudinary upload
              </td>
            </tr>
            <tr>
              <td><code>ContactMessageService</code></td>
              <td>
                <code>markAsRead()</code>, <code>markAsReplied()</code>,
                <code>markAsUnreplied()</code>
              </td>
              <td>æ›´æ–° isRead / isReplied æ¬„ä½ï¼›æ”¯æ´å–æ¶ˆå·²å›è¦†</td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-repository">
          3.3 Repository å±¤ (æŒä¹…å±¤) - 7 å€‹ Repository
        </h3>
        <table>
          <thead>
            <tr>
              <th>Repository</th>
              <th>ç¹¼æ‰¿</th>
              <th>è‡ªè¨‚æ–¹æ³•</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>ProductRepository</code></td>
              <td>JpaRepository</td>
              <td>
                5 å€‹ï¼š<code>findByIsListedTrue()</code>,
                <code>searchProducts()</code> (JPQL),
                <code>countByIsFeaturedTrue()</code>
              </td>
            </tr>
            <tr>
              <td><code>OrderRepository</code></td>
              <td>JpaRepository</td>
              <td>
                5 å€‹ï¼š<code>existsByUserUserIdAndStatusIn()</code> æª¢æŸ¥æ´»èºè¨‚å–®
              </td>
            </tr>
            <tr>
              <td><code>UserRepository</code></td>
              <td>JpaRepository</td>
              <td><code>findByEmail()</code>, <code>existsByEmail()</code></td>
            </tr>
            <tr>
              <td><code>CartItemRepository</code></td>
              <td>JpaRepository</td>
              <td>
                <code>findByUserUserId()</code>,
                <code>deleteByUserUserId()</code>
              </td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-model">3.4 Model å±¤ (é ˜åŸŸå¯¦é«”) - 8 å€‹ POJO</h3>
        <table>
          <thead>
            <tr>
              <th>å¯¦é«”</th>
              <th>é—œéµ Annotation</th>
              <th>è¨­è¨ˆé‡é»</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>User</code></td>
              <td>
                <code>@PrePersist</code>, <code>@Enumerated(STRING)</code>
              </td>
              <td>Role: MEMBER/ADMINï¼›è»Ÿåˆªé™¤ï¼ˆisDeleted + deletedAtï¼‰</td>
            </tr>
            <tr>
              <td><code>Product</code></td>
              <td>
                <code>@Table(indexes)</code>,
                <code>@OneToMany(orphanRemoval)</code>
              </td>
              <td>
                3 ç´¢å¼•ï¼ˆcategory_listed, name,
                created_atï¼‰ï¼›åˆªé™¤å•†å“æ™‚é€£å¸¶åˆªé™¤è¦æ ¼
              </td>
            </tr>
            <tr>
              <td><code>ProductVariant</code></td>
              <td>
                <code>@UniqueConstraint</code>, <code>@Index(stock)</code>
              </td>
              <td>
                è¤‡åˆå”¯ä¸€ç´„æŸï¼ˆproduct_id + color + sizeï¼‰ï¼›stock
                ç´¢å¼•å„ªåŒ–åº«å­˜æŸ¥è©¢
              </td>
            </tr>
            <tr>
              <td><code>Order</code></td>
              <td><code>@Table(indexes)</code>, <code>@Enumerated</code></td>
              <td>
                3 ç´¢å¼•ï¼›ç‹€æ…‹ Enumï¼šPENDING â†’ PAID â†’ SHIPPED â†’ COMPLETED /
                CANCELLED
              </td>
            </tr>
            <tr>
              <td><code>OrderItem</code></td>
              <td><code>@ManyToOne</code></td>
              <td>å¿«ç…§ priceï¼Œé¿å…å•†å“èª¿åƒ¹å½±éŸ¿æ­·å²è¨‚å–®</td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-config">3.5 Config å±¤ (é…ç½®æ¨¡çµ„) - 5 å€‹</h3>
        <table>
          <thead>
            <tr>
              <th>é…ç½®é¡åˆ¥</th>
              <th>å¯¦ä½œç´°ç¯€</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>SecurityConfig</code></td>
              <td>
                CORS ç™½åå–®ï¼ˆlocalhost:5173/5174/3000 + Zeaburï¼‰ã€CSRF
                é—œé–‰ã€Stateless Sessionã€JWT Filter è¨»å†Šæ–¼ UsernamePassword ä¹‹å‰
              </td>
            </tr>
            <tr>
              <td><code>DataInitializer</code></td>
              <td>
                å¯¦ä½œ <code>CommandLineRunner</code>ï¼Œå•Ÿå‹•æ™‚å»ºç«‹ admin@choose.com
                / 123456
              </td>
            </tr>
            <tr>
              <td><code>PasswordConfig</code></td>
              <td>ç¨ç«‹å®£å‘Š <code>BCryptPasswordEncoder</code> é¿å…å¾ªç’°ä¾è³´</td>
            </tr>
            <tr>
              <td><code>CloudinaryConfig</code></td>
              <td>è®€å–ç’°å¢ƒè®Šæ•¸ CLOUDINARY_URL åˆå§‹åŒ– SDK</td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-security">3.6 Security å±¤ (å®‰å…¨æ¨¡çµ„) - 2 å€‹</h3>
        <table>
          <thead>
            <tr>
              <th>å…ƒä»¶</th>
              <th>å¯¦ä½œç´°ç¯€</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>JwtUtil</code></td>
              <td>
                HMAC-SHA256 ç°½ç« ï¼›Claims å« userId, email, roleï¼›é©—è­‰éæœŸ + ç°½ç« 
              </td>
            </tr>
            <tr>
              <td><code>JwtAuthenticationFilter</code></td>
              <td>
                å„ªå…ˆå¾ Cookie(auth_token) æå–ï¼Œå…¶æ¬¡ Authorization
                Headerï¼›é©—è­‰å¾Œæ³¨å…¥ UsernamePasswordAuthenticationToken
              </td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-dto">3.7 DTO å±¤ (è³‡æ–™å‚³è¼¸ç‰©ä»¶) - 6 å€‹</h3>
        <table>
          <thead>
            <tr>
              <th>DTO</th>
              <th>æ¬„ä½æ•¸</th>
              <th>ç‰¹æ®Šè™•ç†</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>ProductDTO</code></td>
              <td>11</td>
              <td>productId â†’ id, imageUrl â†’ image, èšåˆ variants åº«å­˜ç¸½å’Œ</td>
            </tr>
            <tr>
              <td><code>OrderDTO</code></td>
              <td>13</td>
              <td>
                å·¢ç‹€ <code>OrderItemDTO</code>ï¼ˆå« productName, skuCode,
                subtotal è¨ˆç®—ï¼‰
              </td>
            </tr>
            <tr>
              <td><code>CartItemDTO</code></td>
              <td>-</td>
              <td>å±•é–‹ Variant è³‡è¨Šä¾›å‰ç«¯é¡¯ç¤º</td>
            </tr>
          </tbody>
        </table>

        <h3 id="sec-common">3.8 Common å±¤ (æ©«åˆ‡é—œæ³¨é») - 2 å€‹</h3>
        <table>
          <thead>
            <tr>
              <th>å…ƒä»¶</th>
              <th>å¯¦ä½œç´°ç¯€</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>ApiResponse&lt;T&gt;</code></td>
              <td>
                3 æ¬„ä½ï¼šsuccess, message, dataï¼›3
                éœæ…‹æ–¹æ³•ï¼š<code>success(data)</code>,
                <code>success(msg, data)</code>, <code>error(msg)</code>
              </td>
            </tr>
            <tr>
              <td><code>GlobalExceptionHandler</code></td>
              <td>
                @RestControllerAdvice è™•ç†
                <strong>8 ç¨®ä¾‹å¤–</strong>ï¼šMethodArgumentNotValid,
                IllegalArgument, EntityNotFound, AccessDenied, BadCredentials,
                NoHandlerFound, Runtime, Exception
              </td>
            </tr>
          </tbody>
        </table>

        <hr />

        <h2 id="sec-annotation">4. æ ¸å¿ƒ Annotation æ·±åº¦è§£æ</h2>
        <table>
          <thead>
            <tr>
              <th>Annotation</th>
              <th>å±¤ç´š</th>
              <th>ä½¿ç”¨åŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>@Transactional</code></td>
              <td>Service</td>
              <td>
                ç¢ºä¿ createOrder çš„åº«å­˜æ‰£æ¸› +
                è¨‚å–®å­˜æª”ç‚ºåŸå­æ“ä½œï¼›RuntimeException è‡ªå‹• Rollback
              </td>
            </tr>
            <tr>
              <td><code>@PreAuthorize</code></td>
              <td>Controller</td>
              <td>SpEL è¡¨é”å¼æª¢æŸ¥ hasRole('ADMIN')ï¼Œæ¯” URL é…ç½®æ›´ç²¾ç´°</td>
            </tr>
            <tr>
              <td><code>@AuthenticationPrincipal</code></td>
              <td>Controller</td>
              <td>å¾ SecurityContext æ³¨å…¥ User ç‰©ä»¶ï¼Œé¿å…æ‰‹å‹•æŸ¥è¡¨</td>
            </tr>
            <tr>
              <td><code>@PrePersist</code></td>
              <td>Model</td>
              <td>INSERT å‰è‡ªå‹•å¡«å…¥ createdAtï¼Œç¢ºä¿ audit ä¸€è‡´æ€§</td>
            </tr>
            <tr>
              <td><code>@ManyToOne(fetch=LAZY)</code></td>
              <td>Model</td>
              <td>å»¶é²è¼‰å…¥é—œè¯ç‰©ä»¶ï¼Œæ¸›å°‘ä¸å¿…è¦çš„ JOIN æŸ¥è©¢</td>
            </tr>
            <tr>
              <td><code>@Table(indexes)</code></td>
              <td>Model</td>
              <td>å»ºç«‹ DB ç´¢å¼•å„ªåŒ– WHERE/ORDER BY æ•ˆèƒ½</td>
            </tr>
            <tr>
              <td><code>@UniqueConstraint</code></td>
              <td>Model</td>
              <td>ProductVariant è¤‡åˆå”¯ä¸€ç´„æŸé˜²æ­¢é‡è¤‡è¦æ ¼</td>
            </tr>
            <tr>
              <td><code>@RestControllerAdvice</code></td>
              <td>Common</td>
              <td>å…¨åŸŸä¾‹å¤–æ””æˆªå™¨ï¼Œå›å‚³æ¨™æº–åŒ– ApiResponse éŒ¯èª¤æ ¼å¼</td>
            </tr>
          </tbody>
        </table>

        <hr />

        <h2 id="sec-auth-flow">5. JWT èªè­‰æˆæ¬Šæµç¨‹æ™‚åºåœ–</h2>
        <div class="diagram-box">
          <div class="diagram-title">JWT èªè­‰èˆ‡ SecurityContext æ³¨å…¥</div>
          <div class="mermaid" id="diagram-auth"></div>
        </div>

        <hr />

        <h2 id="sec-order-flow">6. è¨‚å–®å»ºç«‹äº¤æ˜“æ™‚åºåœ–</h2>
        <div class="diagram-box">
          <div class="diagram-title">Order Creation Lifecycle</div>
          <div class="mermaid" id="diagram-order"></div>
        </div>

        <hr />

        <h2 id="sec-summary">7. å°ˆæ¡ˆçµ±è¨ˆæ‘˜è¦</h2>
        <table>
          <thead>
            <tr>
              <th>å±¤ç´š</th>
              <th>æª”æ¡ˆæ•¸</th>
              <th>ä»£è¡¨æ€§æª”æ¡ˆ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Controller</td>
              <td>9</td>
              <td>AuthController, OrderController, ProductController</td>
            </tr>
            <tr>
              <td>Service</td>
              <td>7</td>
              <td>OrderService, ProductService, UserService</td>
            </tr>
            <tr>
              <td>Repository</td>
              <td>7</td>
              <td>ProductRepository (JPQL), OrderRepository</td>
            </tr>
            <tr>
              <td>Model</td>
              <td>8</td>
              <td>User, Product, Order, ProductVariant</td>
            </tr>
            <tr>
              <td>DTO</td>
              <td>6</td>
              <td>ProductDTO (11 æ¬„ä½), OrderDTO (å·¢ç‹€)</td>
            </tr>
            <tr>
              <td>Config</td>
              <td>5</td>
              <td>SecurityConfig, DataInitializer</td>
            </tr>
            <tr>
              <td>Security</td>
              <td>2</td>
              <td>JwtUtil, JwtAuthenticationFilter</td>
            </tr>
            <tr>
              <td>Common</td>
              <td>2</td>
              <td>ApiResponse (3 æ–¹æ³•), GlobalExceptionHandler (8 ä¾‹å¤–)</td>
            </tr>
            <tr>
              <td><strong>ç¸½è¨ˆ</strong></td>
              <td><strong>48</strong></td>
              <td>ï¼ˆå« BackendApplication + ServletInitializerï¼‰</td>
            </tr>
          </tbody>
        </table>

        <hr />
        <p style="text-align: center; color: #94a3b8; font-size: 0.8rem">
          Â© 2025 Choose Studio. Verified Edition 8.2 | äº¤å‰æ¯”å° 48 å€‹åŸå§‹æª”å®Œæˆ
          | æƒææ™‚é–“ï¼š2025-12-21 15:57
        </p>

        <!-- ========== SECTION 8: CONTROLLER æ–¹æ³•è©³è§£ ========== -->
        <hr />
        <h2 id="sec-controller-detail">8. Controller æ–¹æ³•è©³è§£</h2>
        <p>
          ä»¥ä¸‹é‡å°æ¯å€‹ Controller çš„ API æ–¹æ³•é€²è¡Œæ·±åº¦è§£æï¼ŒåŒ…å« Annotation
          èªæ³•ã€ä¼æ¥­é‚è¼¯èˆ‡å”ä½œé—œä¿‚ã€‚
        </p>

        <!-- 8.1 AuthController -->
        <h3>8.1 AuthController</h3>
        <p>
          <strong>è·è²¬</strong>ï¼šè™•ç†ç”¨æˆ¶èªè­‰ï¼ˆè¨»å†Šã€ç™»å…¥ã€ç™»å‡ºï¼‰ã€JWT Token
          ç®¡ç†ã€‚
        </p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/auth</code></p>
        <p>
          <strong>ä¾è³´æ³¨å…¥</strong
          >ï¼š<code>UserService</code>ã€<code>JwtUtil</code>ã€<code
            >PasswordEncoder</code
          >
        </p>

        <h4>8.1.1 register()</h4>
        <pre><code class="language-java">@PostMapping("/register")
public ResponseEntity&lt;ApiResponse&lt;UserResponse&gt;&gt; register(
    @Valid @RequestBody RegisterRequest request)</code></pre>
        <table>
          <thead>
            <tr>
              <th>Annotation</th>
              <th>ä½ç½®</th>
              <th>æ„ç¾©</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>@PostMapping("/register")</code></td>
              <td>æ–¹æ³•</td>
              <td>æ˜ å°„ HTTP POST è«‹æ±‚è‡³ <code>/api/auth/register</code></td>
            </tr>
            <tr>
              <td><code>@Valid</code></td>
              <td>åƒæ•¸</td>
              <td>å•Ÿç”¨ Bean Validationï¼Œé©—è­‰ RegisterRequest æ¬„ä½ç´„æŸ</td>
            </tr>
            <tr>
              <td><code>@RequestBody</code></td>
              <td>åƒæ•¸</td>
              <td>å°‡ HTTP Body çš„ JSON è‡ªå‹•ååºåˆ—åŒ–ç‚º Java ç‰©ä»¶</td>
            </tr>
          </tbody>
        </table>
        <p><strong>ä¼æ¥­é‚è¼¯</strong>ï¼š</p>
        <ol>
          <li>æª¢æŸ¥ Email æ˜¯å¦å·²è¢«è¨»å†Š â†’ é˜²æ­¢é‡è¤‡å¸³è™Ÿ</li>
          <li>BCrypt åŠ å¯†å¯†ç¢¼ â†’ è³‡æ–™åº«ä¸å­˜æ˜æ–‡</li>
          <li>ç”Ÿæˆ JWT Token â†’ è¨»å†Šå¾Œè‡ªå‹•ç™»å…¥</li>
          <li>è¨­ç½® HttpOnly Cookie â†’ é˜²æ­¢ XSS æ”»æ“Š</li>
        </ol>
        <p>
          <strong>å”ä½œ</strong>ï¼š<code>UserService.register()</code> â†’
          <code>JwtUtil.generateToken()</code>
        </p>

        <h4>8.1.2 login()</h4>
        <pre><code class="language-java">@PostMapping("/login")
public ResponseEntity&lt;ApiResponse&lt;UserResponse&gt;&gt; login(
    @Valid @RequestBody LoginRequest request)</code></pre>
        <p><strong>ä¼æ¥­é‚è¼¯</strong>ï¼š</p>
        <ol>
          <li>æŸ¥è©¢ç”¨æˆ¶ â†’ <code>UserService.findByEmail()</code></li>
          <li>é©—è­‰å¯†ç¢¼ â†’ <code>PasswordEncoder.matches()</code></li>
          <li>ç”Ÿæˆ JWT â†’ é›™è»Œç™¼æ”¾ï¼ˆCookie + Response Bodyï¼‰</li>
        </ol>
        <p><strong>åè©è§£é‡‹</strong>ï¼š</p>
        <ul>
          <li>
            <code>BCrypt</code
            >ï¼šå¯†ç¢¼é›œæ¹Šæ¼”ç®—æ³•ï¼Œå–®å‘åŠ å¯†ä¸”å«éš¨æ©Ÿé¹½å€¼ï¼Œæ¯æ¬¡åŠ å¯†çµæœä¸åŒ
          </li>
          <li>
            <code>HttpOnly Cookie</code>ï¼šJavaScript ç„¡æ³•å­˜å–çš„ Cookieï¼Œé˜²æ­¢ XSS
            ç›œå– Token
          </li>
          <li>
            <code>SameSite=None</code>ï¼šå…è¨±è·¨åŸŸè«‹æ±‚æ”œå¸¶ Cookieï¼Œéœ€é…åˆ
            <code>Secure=true</code>
          </li>
        </ul>

        <h4>8.1.3 getCurrentUser()</h4>
        <pre><code class="language-java">@GetMapping("/me")
public ResponseEntity&lt;ApiResponse&lt;UserResponse&gt;&gt; getCurrentUser(
    @AuthenticationPrincipal User user)</code></pre>
        <p><strong>Annotation è§£æ</strong>ï¼š</p>
        <ul>
          <li>
            <code>@AuthenticationPrincipal</code>ï¼šå¾ SecurityContext
            å–å¾—ç•¶å‰å·²èªè­‰ç”¨æˆ¶ï¼Œç”± JwtAuthenticationFilter æ³¨å…¥
          </li>
        </ul>

        <h4>8.1.4 logout()</h4>
        <pre><code class="language-java">@PostMapping("/logout")
public ResponseEntity&lt;ApiResponse&lt;String&gt;&gt; logout(
    @AuthenticationPrincipal User user)</code></pre>
        <p>
          <strong>ä¼æ¥­é‚è¼¯</strong>ï¼šæ¸…é™¤ HttpOnly Cookieï¼ˆè¨­ç½® maxAge=0ï¼‰ï¼Œä½¿
          Token åœ¨ç€è¦½å™¨ç«¯å¤±æ•ˆã€‚
        </p>

        <!-- 8.2 CartController -->
        <h3>8.2 CartController</h3>
        <p><strong>è·è²¬</strong>ï¼šè³¼ç‰©è»Šç®¡ç†ï¼ˆæ–°å¢ã€ä¿®æ”¹æ•¸é‡ã€ç§»é™¤ã€æ¸…ç©ºï¼‰ã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/cart</code></p>
        <p><strong>ä¾è³´æ³¨å…¥</strong>ï¼š<code>CartService</code></p>

        <h4>8.2.1 getCart()</h4>
        <pre><code class="language-java">@GetMapping
public ResponseEntity&lt;ApiResponse&lt;List&lt;CartItemDTO&gt;&gt;&gt; getCart(
    @AuthenticationPrincipal User user)</code></pre>
        <p>
          <strong>ä¼æ¥­é‚è¼¯</strong>ï¼šå–å¾—ç”¨æˆ¶è³¼ç‰©è»Šå…§å®¹ï¼Œè½‰æ›ç‚º DTO
          å›å‚³ï¼ˆå«å•†å“åç¨±ã€åƒ¹æ ¼ã€è¦æ ¼è³‡è¨Šï¼‰ã€‚
        </p>

        <h4>8.2.2 addToCart()</h4>
        <pre><code class="language-java">@PostMapping
public ResponseEntity&lt;ApiResponse&lt;CartItemDTO&gt;&gt; addToCart(
    @AuthenticationPrincipal User user,
    @Valid @RequestBody AddToCartRequest request)</code></pre>
        <p><strong>ä¼æ¥­é‚è¼¯</strong>ï¼š</p>
        <ol>
          <li>è‹¥è³¼ç‰©è»Šå·²æœ‰ç›¸åŒè¦æ ¼ â†’ åˆä½µæ•¸é‡</li>
          <li>é©—è­‰åº«å­˜ â†’ åº«å­˜ä¸è¶³æ‹‹å‡ºä¾‹å¤–</li>
          <li>æ–°å¢ CartItem è‡³è³‡æ–™åº«</li>
        </ol>

        <h4>8.2.3 updateQuantity()</h4>
        <pre><code class="language-java">@PutMapping("/{cartItemId}")
public ResponseEntity&lt;ApiResponse&lt;CartItemDTO&gt;&gt; updateQuantity(
    @AuthenticationPrincipal User user,
    @PathVariable Long cartItemId,
    @Valid @RequestBody UpdateQuantityRequest request)</code></pre>
        <p><strong>Annotation è§£æ</strong>ï¼š</p>
        <ul>
          <li>
            <code>@PathVariable</code>ï¼šå¾ URL è·¯å¾‘æå–åƒæ•¸ï¼Œå¦‚
            <code>/api/cart/123</code> ä¸­çš„ <code>123</code>
          </li>
        </ul>
        <p>
          <strong>ä¼æ¥­é‚è¼¯</strong
          >ï¼šé©—è­‰æ‰€æœ‰æ¬Šï¼ˆåªèƒ½ä¿®æ”¹è‡ªå·±çš„è³¼ç‰©è»Šé …ç›®ï¼‰ã€é©—è­‰åº«å­˜ã€‚
        </p>

        <h4>8.2.4 removeFromCart()</h4>
        <pre><code class="language-java">@DeleteMapping("/{cartItemId}")
public ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; removeFromCart(
    @AuthenticationPrincipal User user,
    @PathVariable Long cartItemId)</code></pre>
        <p><strong>ä¼æ¥­é‚è¼¯</strong>ï¼šé©—è­‰æ‰€æœ‰æ¬Šå¾Œåˆªé™¤å–®ä¸€è³¼ç‰©è»Šé …ç›®ã€‚</p>

        <h4>8.2.5 clearCart()</h4>
        <pre><code class="language-java">@DeleteMapping
public ResponseEntity&lt;ApiResponse&lt;Void&gt;&gt; clearCart(
    @AuthenticationPrincipal User user)</code></pre>
        <p>
          <strong>ä¼æ¥­é‚è¼¯</strong
          >ï¼šæ¸…ç©ºç”¨æˆ¶æ‰€æœ‰è³¼ç‰©è»Šé …ç›®ï¼Œé€šå¸¸åœ¨è¨‚å–®å»ºç«‹æˆåŠŸå¾Œç”±å‰ç«¯èª¿ç”¨ã€‚
        </p>

        <!-- 8.3 CategoryController -->
        <h3>8.3 CategoryController</h3>
        <p><strong>è·è²¬</strong>ï¼šå•†å“åˆ†é¡ CRUDï¼ˆå‰å°è®€å–ã€å¾Œå°ç®¡ç†ï¼‰ã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/categories</code></p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllCategories()</td>
              <td>GET /</td>
              <td>å…¬é–‹</td>
              <td>åˆ—å‡ºæ‰€æœ‰åˆ†é¡</td>
            </tr>
            <tr>
              <td>getCategoryById()</td>
              <td>GET /{id}</td>
              <td>å…¬é–‹</td>
              <td>å–å¾—å–®ä¸€åˆ†é¡</td>
            </tr>
            <tr>
              <td>createCategory()</td>
              <td>POST /</td>
              <td>ADMIN</td>
              <td>æ–°å¢åˆ†é¡</td>
            </tr>
            <tr>
              <td>updateCategory()</td>
              <td>PUT /{id}</td>
              <td>ADMIN</td>
              <td>æ›´æ–°åˆ†é¡</td>
            </tr>
            <tr>
              <td>deleteCategory()</td>
              <td>DELETE /{id}</td>
              <td>ADMIN</td>
              <td>åˆªé™¤åˆ†é¡</td>
            </tr>
          </tbody>
        </table>
        <p><strong>æ¬Šé™æ§åˆ¶ Annotation</strong>ï¼š</p>
        <pre><code class="language-java">@PreAuthorize("hasRole('ADMIN')")</code></pre>
        <p>ä½¿ç”¨ Spring Security Method Securityï¼Œåœ¨æ–¹æ³•åŸ·è¡Œå‰é©—è­‰ç”¨æˆ¶è§’è‰²ã€‚</p>

        <!-- 8.4 InquiryController -->
        <h3>8.4 InquiryController</h3>
        <p>
          <strong>è·è²¬</strong>ï¼šå®¢æœç•™è¨€ç®¡ç†ï¼ˆç”¨æˆ¶æäº¤ã€ç®¡ç†å“¡æŸ¥çœ‹/æ¨™è¨˜ç‹€æ…‹ï¼‰ã€‚
        </p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/inquiries</code></p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllInquiries()</td>
              <td>GET /</td>
              <td>ADMIN</td>
              <td>åˆ—å‡ºæ‰€æœ‰ç•™è¨€ï¼ˆæŒ‰æ™‚é–“é™åºï¼‰</td>
            </tr>
            <tr>
              <td>getInquiryById()</td>
              <td>GET /{id}</td>
              <td>ADMIN</td>
              <td>å–å¾—å–®ä¸€ç•™è¨€</td>
            </tr>
            <tr>
              <td>createInquiry()</td>
              <td>POST /</td>
              <td>å…¬é–‹</td>
              <td>æäº¤ç•™è¨€ï¼ˆå¯åŒ¿åï¼‰</td>
            </tr>
            <tr>
              <td>markAsRead()</td>
              <td>PATCH /{id}/read</td>
              <td>ADMIN</td>
              <td>æ¨™è¨˜ç‚ºå·²è®€</td>
            </tr>
            <tr>
              <td>markAsReplied()</td>
              <td>PATCH /{id}/reply</td>
              <td>ADMIN</td>
              <td>æ¨™è¨˜ç‚ºå·²å›è¦†</td>
            </tr>
            <tr>
              <td>markAsUnreplied()</td>
              <td>PATCH /{id}/unreply</td>
              <td>ADMIN</td>
              <td>å–æ¶ˆå·²å›è¦†ç‹€æ…‹ï¼ˆæ¢å¾©ç‚ºæœªè®€ï¼‰</td>
            </tr>
            <tr>
              <td>deleteInquiry()</td>
              <td>DELETE /{id}</td>
              <td>ADMIN</td>
              <td>åˆªé™¤ç•™è¨€</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>ç‰¹æ®ŠåŠŸèƒ½</strong>ï¼š<code>createInquiry()</code> æœƒæ“·å–
          <code>X-Forwarded-For</code> Header å–å¾—ç”¨æˆ¶çœŸå¯¦
          IPï¼ˆç”¨æ–¼ååƒåœ¾ç•™è¨€ï¼‰ã€‚
        </p>

        <!-- 8.5 OrderController -->
        <h3>8.5 OrderController</h3>
        <p><strong>è·è²¬</strong>ï¼šè¨‚å–®ç®¡ç†ï¼ˆå»ºç«‹ã€æŸ¥è©¢ã€ç‹€æ…‹æ›´æ–°ï¼‰ã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/orders</code></p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllOrders()</td>
              <td>GET /</td>
              <td>ADMIN</td>
              <td>åˆ—å‡ºæ‰€æœ‰è¨‚å–®</td>
            </tr>
            <tr>
              <td>getMyOrders()</td>
              <td>GET /my</td>
              <td>èªè­‰</td>
              <td>å–å¾—ç•¶å‰ç”¨æˆ¶è¨‚å–®</td>
            </tr>
            <tr>
              <td>getUserOrders()</td>
              <td>GET /user/{userId}</td>
              <td>ADMIN</td>
              <td>å–å¾—æŒ‡å®šç”¨æˆ¶è¨‚å–®</td>
            </tr>
            <tr>
              <td>getOrderById()</td>
              <td>GET /{id}</td>
              <td>èªè­‰</td>
              <td>å–å¾—å–®ä¸€è¨‚å–®</td>
            </tr>
            <tr>
              <td>createOrder()</td>
              <td>POST /</td>
              <td>èªè­‰</td>
              <td>å»ºç«‹è¨‚å–®ï¼ˆå«åº«å­˜æ‰£æ¸›ï¼‰</td>
            </tr>
            <tr>
              <td>updateOrderStatus()</td>
              <td>PATCH /{id}/status</td>
              <td>ADMIN</td>
              <td>æ›´æ–°è¨‚å–®ç‹€æ…‹</td>
            </tr>
            <tr>
              <td>updatePaymentNote()</td>
              <td>PATCH /{id}/payment-note</td>
              <td>èªè­‰</td>
              <td>æ›´æ–°ä»˜æ¬¾å‚™è¨»</td>
            </tr>
          </tbody>
        </table>
        <h4>createOrder() ä¼æ¥­é‚è¼¯</h4>
        <ol>
          <li>é©—è­‰ç”¨æˆ¶èº«ä»½</li>
          <li>å»ºç«‹ Order ç‰©ä»¶ï¼ˆå«é‹é€è³‡è¨Šï¼‰</li>
          <li>è½‰æ› Request Items ç‚º OrderItems</li>
          <li>
            èª¿ç”¨ <code>OrderService.createOrder()</code>ï¼ˆ@Transactionalï¼‰
          </li>
          <li>Service å…§éƒ¨åŸ·è¡Œåº«å­˜æ‰£æ¸› + è¨‚å–®å„²å­˜</li>
        </ol>

        <!-- 8.6 ProductController -->
        <h3>8.6 ProductController</h3>
        <p><strong>è·è²¬</strong>ï¼šå•†å“ç®¡ç†ï¼ˆCRUDã€æœå°‹ã€ç²¾é¸åˆ‡æ›ï¼‰ã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/products</code></p>
        <p>
          <strong>ä¾è³´æ³¨å…¥</strong>ï¼š<code>ProductService</code>ã€<code
            >CategoryService</code
          >
        </p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllProducts()</td>
              <td>GET /</td>
              <td>å…¬é–‹</td>
              <td>åˆ—å‡ºå·²ä¸Šæ¶å•†å“</td>
            </tr>
            <tr>
              <td>getProductById()</td>
              <td>GET /{id}</td>
              <td>å…¬é–‹</td>
              <td>å–å¾—å–®ä¸€å•†å“</td>
            </tr>
            <tr>
              <td>getProductsByCategory()</td>
              <td>GET /category/{id}</td>
              <td>å…¬é–‹</td>
              <td>åˆ†é¡ç¯©é¸</td>
            </tr>
            <tr>
              <td>searchProducts()</td>
              <td>GET /search</td>
              <td>å…¬é–‹</td>
              <td>é—œéµå­—æœå°‹</td>
            </tr>
            <tr>
              <td>getProductVariants()</td>
              <td>GET /{id}/variants</td>
              <td>å…¬é–‹</td>
              <td>å–å¾—å•†å“è¦æ ¼</td>
            </tr>
            <tr>
              <td>getFeaturedProducts()</td>
              <td>GET /featured</td>
              <td>å…¬é–‹</td>
              <td>å–å¾—ç²¾é¸å•†å“</td>
            </tr>
            <tr>
              <td>getAllProductsAdmin()</td>
              <td>GET /admin/all</td>
              <td>ADMIN</td>
              <td>åˆ—å‡ºå…¨éƒ¨å•†å“ï¼ˆå«æœªä¸Šæ¶ï¼‰</td>
            </tr>
            <tr>
              <td>createProduct()</td>
              <td>POST /</td>
              <td>ADMIN</td>
              <td>æ–°å¢å•†å“</td>
            </tr>
            <tr>
              <td>updateProduct()</td>
              <td>PUT /{id}</td>
              <td>ADMIN</td>
              <td>æ›´æ–°å•†å“</td>
            </tr>
            <tr>
              <td>deleteProduct()</td>
              <td>DELETE /{id}</td>
              <td>ADMIN</td>
              <td>åˆªé™¤å•†å“</td>
            </tr>
            <tr>
              <td>updateProductStock()</td>
              <td>PATCH /{id}/stock</td>
              <td>ADMIN</td>
              <td>æ›´æ–°åº«å­˜</td>
            </tr>
            <tr>
              <td>toggleFeatured()</td>
              <td>PATCH /{id}/featured</td>
              <td>ADMIN</td>
              <td>åˆ‡æ›ç²¾é¸ç‹€æ…‹</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>ç²¾é¸ä¸Šé™æª¢æŸ¥</strong>ï¼š<code>toggleFeatured()</code> èª¿ç”¨
          <code>ProductService.toggleFeatured()</code>ï¼Œå…§éƒ¨æª¢æŸ¥ç²¾é¸å•†å“ä¸è¶…é 8
          ä»¶ã€‚
        </p>

        <!-- 8.7 ProductVariantController -->
        <h3>8.7 ProductVariantController</h3>
        <p><strong>è·è²¬</strong>ï¼šå•†å“è¦æ ¼ï¼ˆSKUï¼‰ç®¡ç†ã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/variants</code></p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getVariantsByProduct()</td>
              <td>GET /product/{id}</td>
              <td>å…¬é–‹</td>
              <td>å–å¾—å•†å“è¦æ ¼åˆ—è¡¨</td>
            </tr>
            <tr>
              <td>createVariant()</td>
              <td>POST /</td>
              <td>ADMIN</td>
              <td>æ–°å¢è¦æ ¼ï¼ˆSKU è‡ªå‹•ç”Ÿæˆï¼‰</td>
            </tr>
            <tr>
              <td>updateVariant()</td>
              <td>PUT /{id}</td>
              <td>ADMIN</td>
              <td>æ›´æ–°è¦æ ¼</td>
            </tr>
            <tr>
              <td>updateStock()</td>
              <td>PATCH /{id}/stock</td>
              <td>ADMIN</td>
              <td>æ›´æ–°åº«å­˜</td>
            </tr>
            <tr>
              <td>deleteVariant()</td>
              <td>DELETE /{id}</td>
              <td>ADMIN</td>
              <td>åˆªé™¤è¦æ ¼</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>SKU è‡ªå‹•ç”Ÿæˆ</strong>ï¼šç”±
          <code>ProductService.generateUniqueSku()</code> è™•ç†ï¼Œæ ¼å¼ç‚º
          <code>{PRODUCT_ABBR}-{COLOR}-{SIZE}-{RANDOM}</code>ã€‚
        </p>

        <!-- 8.8 UploadController -->
        <h3>8.8 UploadController</h3>
        <p><strong>è·è²¬</strong>ï¼šåœ–ç‰‡ä¸Šå‚³è‡³ Cloudinaryã€‚</p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/upload</code></p>
        <h4>uploadImage()</h4>
        <pre><code class="language-java">@PostMapping(value = "/image", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
@PreAuthorize("hasRole('ADMIN')")
public ResponseEntity&lt;ApiResponse&lt;ImageUploadResponse&gt;&gt; uploadImage(
    @RequestParam("file") MultipartFile file)</code></pre>
        <p><strong>Annotation è§£æ</strong>ï¼š</p>
        <ul>
          <li>
            <code>consumes = MediaType.MULTIPART_FORM_DATA_VALUE</code>ï¼šåªæ¥å—
            multipart/form-data æ ¼å¼
          </li>
          <li>
            <code>@RequestParam("file")</code>ï¼šå¾ form-data ä¸­æå–åç‚º "file"
            çš„æª”æ¡ˆ
          </li>
        </ul>
        <p>
          <strong>ä¼æ¥­é‚è¼¯</strong>ï¼šé©—è­‰æª”æ¡ˆé¡å‹ï¼ˆjpg/png/gif/webpï¼‰â†’
          é©—è­‰å¤§å°ï¼ˆ&lt;5MBï¼‰â†’ ä¸Šå‚³è‡³ Cloudinary â†’ å›å‚³ URLã€‚
        </p>

        <!-- 8.9 UserController -->
        <h3>8.9 UserController</h3>
        <p>
          <strong>è·è²¬</strong
          >ï¼šç”¨æˆ¶è³‡æ–™ç®¡ç†ï¼ˆå€‹è³‡æŸ¥è©¢/æ›´æ–°ã€å¯†ç¢¼è®Šæ›´ã€å¸³è™Ÿåˆªé™¤ï¼‰ã€‚
        </p>
        <p><strong>è·¯ç”±å‰ç¶´</strong>ï¼š<code>/api/users</code></p>
        <p>
          <strong>ä¾è³´æ³¨å…¥</strong
          >ï¼š<code>UserService</code>ã€<code>OrderService</code>ã€<code
            >CartService</code
          >
        </p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>è·¯ç”±</th>
              <th>æ¬Šé™</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getMyProfile()</td>
              <td>GET /me</td>
              <td>èªè­‰</td>
              <td>å–å¾—ç•¶å‰ç”¨æˆ¶è³‡æ–™</td>
            </tr>
            <tr>
              <td>updateMyProfile()</td>
              <td>PUT /me</td>
              <td>èªè­‰</td>
              <td>æ›´æ–°å€‹è³‡</td>
            </tr>
            <tr>
              <td>getAllUsers()</td>
              <td>GET /</td>
              <td>ADMIN</td>
              <td>åˆ—å‡ºæ‰€æœ‰ç”¨æˆ¶</td>
            </tr>
            <tr>
              <td>getUserById()</td>
              <td>GET /{id}</td>
              <td>ADMIN</td>
              <td>å–å¾—æŒ‡å®šç”¨æˆ¶</td>
            </tr>
            <tr>
              <td>changePassword()</td>
              <td>PUT /password</td>
              <td>èªè­‰</td>
              <td>è®Šæ›´å¯†ç¢¼</td>
            </tr>
            <tr>
              <td>deleteMyAccount()</td>
              <td>POST /me/delete</td>
              <td>èªè­‰</td>
              <td>åˆªé™¤å¸³è™Ÿ</td>
            </tr>
          </tbody>
        </table>
        <h4>deleteMyAccount() ä¼æ¥­é‚è¼¯</h4>
        <ol>
          <li>é©—è­‰å¯†ç¢¼</li>
          <li>æª¢æŸ¥æ˜¯å¦æœ‰æ´»èºè¨‚å–®ï¼ˆPENDING/PAID/SHIPPEDï¼‰</li>
          <li>å»è­˜åˆ¥åŒ–ï¼šEmail â†’ <code>deleted-{uuid}@inactive.local</code></li>
          <li>æ¸…ç©ºè³¼ç‰©è»Š</li>
          <li>
            è»Ÿåˆªé™¤ï¼šè¨­ç½® <code>isDeleted=true</code>ã€<code>deletedAt</code>
          </li>
        </ol>
        <p>
          <strong>è¨­è¨ˆåŸå› </strong>ï¼šä½¿ç”¨ POST æ›¿ä»£ DELETE æ˜¯å› ç‚º DELETE
          è«‹æ±‚ä¸æ”¯æ´ Request Bodyï¼ˆéœ€è¦å¯†ç¢¼é©—è­‰ï¼‰ã€‚
        </p>

        <!-- ========== SECTION 9: SERVICE æ–¹æ³•è©³è§£ ========== -->
        <hr />
        <h2 id="sec-service-detail">9. Service æ–¹æ³•è©³è§£</h2>
        <p>Service å±¤å°è£æ¥­å‹™è¦å‰‡ï¼Œè™•ç†è·¨ Repository å”èª¿èˆ‡äº¤æ˜“ç®¡ç†ã€‚</p>

        <h3>9.1 UserService</h3>
        <p><strong>è·è²¬</strong>ï¼šç”¨æˆ¶ç›¸é—œæ¥­å‹™é‚è¼¯ã€‚</p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
              <th>é—œéµé‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>register()</td>
              <td>ç”¨æˆ¶è¨»å†Š</td>
              <td>Email å”¯ä¸€æª¢æŸ¥ â†’ BCrypt åŠ å¯† â†’ å­˜å„²</td>
            </tr>
            <tr>
              <td>findByEmail()</td>
              <td>æŸ¥è©¢ç”¨æˆ¶</td>
              <td>ç™»å…¥é©—è­‰ã€JWT é©—è­‰æ™‚ä½¿ç”¨</td>
            </tr>
            <tr>
              <td>findById()</td>
              <td>ID æŸ¥è©¢</td>
              <td>Admin åŠŸèƒ½ã€é—œè¯æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>findAll()</td>
              <td>åˆ—å‡ºæ‰€æœ‰</td>
              <td>Admin ç”¨æˆ¶ç®¡ç†</td>
            </tr>
            <tr>
              <td>updateUser()</td>
              <td>æ›´æ–°è³‡æ–™</td>
              <td>é¸æ“‡æ€§æ›´æ–°ï¼ˆnull æ¬„ä½ä¸å‹•ï¼‰</td>
            </tr>
            <tr>
              <td>changePassword()</td>
              <td>è®Šæ›´å¯†ç¢¼</td>
              <td>é©—èˆŠå¯†ç¢¼ â†’ åŠ å¯†æ–°å¯†ç¢¼</td>
            </tr>
            <tr>
              <td>deleteUserAccount()</td>
              <td>åˆªé™¤å¸³è™Ÿ</td>
              <td>é©—å¯†ç¢¼ â†’ æª¢æ´»èºè¨‚å–® â†’ å»è­˜åˆ¥åŒ– â†’ è»Ÿåˆªé™¤</td>
            </tr>
          </tbody>
        </table>

        <h3>9.2 OrderService</h3>
        <p><strong>è·è²¬</strong>ï¼šè¨‚å–®ç›¸é—œæ¥­å‹™é‚è¼¯ã€‚</p>
        <pre><code class="language-java">@Transactional
public Order createOrder(Long userId, Order orderData) { ... }</code></pre>
        <p>
          <strong>@Transactional ä½œç”¨</strong
          >ï¼šç¢ºä¿è¨‚å–®å»ºç«‹çš„åŸå­æ€§ï¼Œä»»ä¸€æ­¥é©Ÿå¤±æ•—å‰‡å…¨éƒ¨ Rollbackã€‚
        </p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
              <th>é—œéµé‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>createOrder()</td>
              <td>å»ºç«‹è¨‚å–®</td>
              <td>é©—åº«å­˜ â†’ æ‰£åº«å­˜ â†’ å¿«ç…§åƒ¹æ ¼ â†’ å„²å­˜</td>
            </tr>
            <tr>
              <td>getAllOrders()</td>
              <td>åˆ—å‡ºæ‰€æœ‰</td>
              <td>æŒ‰æ™‚é–“é™åº</td>
            </tr>
            <tr>
              <td>getUserOrders()</td>
              <td>ç”¨æˆ¶è¨‚å–®</td>
              <td>userId ç¯©é¸</td>
            </tr>
            <tr>
              <td>getOrderById()</td>
              <td>å–®ä¸€è¨‚å–®</td>
              <td>å« OrderItems é—œè¯è¼‰å…¥</td>
            </tr>
            <tr>
              <td>updateOrderStatus()</td>
              <td>æ›´æ–°ç‹€æ…‹</td>
              <td>ç‹€æ…‹æ©Ÿï¼šPENDING â†’ PAID â†’ SHIPPED â†’ COMPLETED</td>
            </tr>
            <tr>
              <td>updatePaymentNote()</td>
              <td>ä»˜æ¬¾å‚™è¨»</td>
              <td>éŠ€è¡Œè½‰å¸³å¾Œ 5 ç¢¼ç™»è¨˜</td>
            </tr>
            <tr>
              <td>hasActiveOrders()</td>
              <td>æª¢æŸ¥æ´»èºè¨‚å–®</td>
              <td>å¸³è™Ÿåˆªé™¤å‰æª¢æŸ¥</td>
            </tr>
          </tbody>
        </table>

        <h3>9.3 ProductService</h3>
        <p><strong>è·è²¬</strong>ï¼šå•†å“èˆ‡è¦æ ¼ç®¡ç†ã€‚</p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
              <th>é—œéµé‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllListedProducts()</td>
              <td>å·²ä¸Šæ¶å•†å“</td>
              <td>isListed=true ç¯©é¸</td>
            </tr>
            <tr>
              <td>getProductsByCategory()</td>
              <td>åˆ†é¡ç¯©é¸</td>
              <td>categoryId + isListed</td>
            </tr>
            <tr>
              <td>searchProducts()</td>
              <td>é—œéµå­—æœå°‹</td>
              <td>JPQLï¼šåç¨±ã€æè¿°ã€åˆ†é¡åç¨±æ¨¡ç³Šæœå°‹</td>
            </tr>
            <tr>
              <td>createProduct()</td>
              <td>æ–°å¢å•†å“</td>
              <td>è¨­ç½®åˆå§‹å€¼ã€é—œè¯åˆ†é¡</td>
            </tr>
            <tr>
              <td>updateProduct()</td>
              <td>æ›´æ–°å•†å“</td>
              <td>é¸æ“‡æ€§æ›´æ–°</td>
            </tr>
            <tr>
              <td>toggleFeatured()</td>
              <td>ç²¾é¸åˆ‡æ›</td>
              <td>ä¸Šé™ 8 ä»¶æª¢æŸ¥</td>
            </tr>
            <tr>
              <td>createProductVariant()</td>
              <td>æ–°å¢è¦æ ¼</td>
              <td>SKU è‡ªå‹•ç”Ÿæˆ</td>
            </tr>
            <tr>
              <td>generateUniqueSku()</td>
              <td>ç”Ÿæˆ SKU</td>
              <td>æ ¼å¼ï¼š{NAME_ABBR}-{COLOR}-{SIZE}-{RANDOM}</td>
            </tr>
            <tr>
              <td>updateStock()</td>
              <td>æ›´æ–°åº«å­˜</td>
              <td>ç›´æ¥æ›´æ–°</td>
            </tr>
          </tbody>
        </table>

        <h3>9.4 CartService</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
              <th>é—œéµé‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getUserCart()</td>
              <td>å–å¾—è³¼ç‰©è»Š</td>
              <td>userId æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>getCartItem()</td>
              <td>å–®ä¸€é …ç›®</td>
              <td>cartItemId æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>addToCart()</td>
              <td>åŠ å…¥å•†å“</td>
              <td>å·²å­˜åœ¨å‰‡åˆä½µæ•¸é‡ã€é©—åº«å­˜</td>
            </tr>
            <tr>
              <td>updateQuantity()</td>
              <td>æ›´æ–°æ•¸é‡</td>
              <td>é©—æ‰€æœ‰æ¬Šã€é©—åº«å­˜</td>
            </tr>
            <tr>
              <td>removeFromCart()</td>
              <td>ç§»é™¤é …ç›®</td>
              <td>é©—æ‰€æœ‰æ¬Š</td>
            </tr>
            <tr>
              <td>clearCart()</td>
              <td>æ¸…ç©ºè³¼ç‰©è»Š</td>
              <td>æ‰¹æ¬¡åˆªé™¤</td>
            </tr>
          </tbody>
        </table>

        <h3>9.5 CategoryService</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllCategories()</td>
              <td>åˆ—å‡ºæ‰€æœ‰åˆ†é¡</td>
            </tr>
            <tr>
              <td>getCategoryById()</td>
              <td>å–®ä¸€åˆ†é¡</td>
            </tr>
            <tr>
              <td>createCategory()</td>
              <td>æ–°å¢åˆ†é¡</td>
            </tr>
            <tr>
              <td>updateCategory()</td>
              <td>æ›´æ–°åˆ†é¡ï¼ˆé¸æ“‡æ€§æ›´æ–°ï¼‰</td>
            </tr>
            <tr>
              <td>deleteCategory()</td>
              <td>åˆªé™¤åˆ†é¡ï¼ˆå­˜åœ¨æ€§æª¢æŸ¥ï¼‰</td>
            </tr>
          </tbody>
        </table>

        <h3>9.6 ContactMessageService</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>getAllMessages()</td>
              <td>åˆ—å‡ºæ‰€æœ‰ç•™è¨€ï¼ˆæŒ‰æ™‚é–“é™åºï¼‰</td>
            </tr>
            <tr>
              <td>getMessagesByStatus()</td>
              <td>ç‹€æ…‹ç¯©é¸</td>
            </tr>
            <tr>
              <td>getMessageById()</td>
              <td>å–®ä¸€ç•™è¨€</td>
            </tr>
            <tr>
              <td>createMessage()</td>
              <td>å»ºç«‹ç•™è¨€ï¼ˆå« IPã€ç”¨æˆ¶é—œè¯ï¼‰</td>
            </tr>
            <tr>
              <td>markAsRead()</td>
              <td>æ¨™è¨˜å·²è®€</td>
            </tr>
            <tr>
              <td>markAsReplied()</td>
              <td>æ¨™è¨˜å·²å›è¦†ï¼ˆè¨˜éŒ„æ™‚é–“ï¼‰</td>
            </tr>
            <tr>
              <td>markAsUnreplied()</td>
              <td>å–æ¶ˆå·²å›è¦†ï¼ˆæ¸…é™¤æ™‚é–“ã€æ¢å¾©ç‚ºæœªè®€ï¼‰</td>
            </tr>
            <tr>
              <td>deleteMessage()</td>
              <td>åˆªé™¤ç•™è¨€</td>
            </tr>
          </tbody>
        </table>

        <h3>9.7 ImageUploadService</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>èªªæ˜</th>
              <th>é—œéµé‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>uploadImage()</td>
              <td>ä¸Šå‚³åœ–ç‰‡</td>
              <td>é©—é¡å‹ â†’ é©—å¤§å° â†’ Cloudinary SDK â†’ å›å‚³ URL</td>
            </tr>
            <tr>
              <td>isAllowedImageType()</td>
              <td>é¡å‹æª¢æŸ¥</td>
              <td>å…è¨±ï¼šjpg/png/gif/webp</td>
            </tr>
          </tbody>
        </table>

        <!-- ========== SECTION 10: REPOSITORY æ–¹æ³•è©³è§£ ========== -->
        <hr />
        <h2 id="sec-repository-detail">10. Repository æ–¹æ³•è©³è§£</h2>
        <p>
          Repository å±¤ç¹¼æ‰¿ <code>JpaRepository</code>ï¼Œæä¾› CRUD
          åŸºç¤æ–¹æ³•ï¼Œä»¥ä¸‹åˆ—å‡ºè‡ªè¨‚æŸ¥è©¢æ–¹æ³•ã€‚
        </p>

        <h3>10.1 ProductRepository</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>å¯¦ä½œåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>findByIsListedTrue()</code></td>
              <td>å‰å°åªé¡¯ç¤ºå·²ä¸Šæ¶å•†å“</td>
            </tr>
            <tr>
              <td><code>findByCategoryCategoryIdAndIsListedTrue()</code></td>
              <td>åˆ†é¡ç¯©é¸ + åƒ…ä¸Šæ¶</td>
            </tr>
            <tr>
              <td><code>searchProducts(keyword)</code></td>
              <td>JPQL å¤šæ¬„ä½æ¨¡ç³Šæœå°‹</td>
            </tr>
            <tr>
              <td>
                <code
                  >findByIsFeaturedTrueAndIsListedTrueOrderByCreatedAtDesc()</code
                >
              </td>
              <td>ç²¾é¸å•†å“åˆ—è¡¨</td>
            </tr>
            <tr>
              <td><code>countByIsFeaturedTrue()</code></td>
              <td>ç²¾é¸ä¸Šé™ 8 ä»¶æª¢æŸ¥</td>
            </tr>
          </tbody>
        </table>
        <h4>searchProducts JPQL</h4>
        <pre><code class="language-sql">@Query("SELECT p FROM Product p WHERE p.isListed = true AND " +
       "(LOWER(p.name) LIKE LOWER(CONCAT('%', :keyword, '%')) OR " +
       "LOWER(p.description) LIKE LOWER(CONCAT('%', :keyword, '%')) OR " +
       "LOWER(p.category.name) LIKE LOWER(CONCAT('%', :keyword, '%')))")</code></pre>

        <h3>10.2 OrderRepository</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>å¯¦ä½œåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>findByUserUserId()</code></td>
              <td>ç”¨æˆ¶è¨‚å–®æŸ¥è©¢</td>
            </tr>
            <tr>
              <td><code>findByUserUserIdAndStatus()</code></td>
              <td>ç”¨æˆ¶ + ç‹€æ…‹ç¯©é¸</td>
            </tr>
            <tr>
              <td><code>findAllByOrderByCreatedAtDesc()</code></td>
              <td>Admin è¨‚å–®åˆ—è¡¨æ’åº</td>
            </tr>
            <tr>
              <td><code>findByStatus()</code></td>
              <td>ç‹€æ…‹ç¯©é¸</td>
            </tr>
            <tr>
              <td><code>existsByUserUserIdAndStatusIn()</code></td>
              <td>å¸³è™Ÿåˆªé™¤å‰æª¢æŸ¥æ´»èºè¨‚å–®</td>
            </tr>
          </tbody>
        </table>

        <h3>10.3 å…¶ä»– Repository</h3>
        <table>
          <thead>
            <tr>
              <th>Repository</th>
              <th>è‡ªè¨‚æ–¹æ³•</th>
              <th>ç”¨é€”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>CartItemRepository</td>
              <td>
                findByUserUserId()ã€findByUserUserIdAndVariantVariantId()ã€deleteByUserUserId()
              </td>
              <td>è³¼ç‰©è»Šæ“ä½œ</td>
            </tr>
            <tr>
              <td>ProductVariantRepository</td>
              <td>
                findByProductProductId()ã€findBySkuCode()ã€findByProductProductIdAndColorIgnoreCaseAndSizeIgnoreCase()
              </td>
              <td>è¦æ ¼æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>UserRepository</td>
              <td>
                findByEmail()ã€findByEmailAndIsDeletedFalse()ã€existsByEmail()
              </td>
              <td>ç”¨æˆ¶æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>ContactMessageRepository</td>
              <td>
                findAllByOrderByCreatedAtDesc()ã€findByStatus()ã€findByUserUserId()
              </td>
              <td>ç•™è¨€æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>CategoryRepository</td>
              <td>ï¼ˆç„¡è‡ªè¨‚ï¼Œä½¿ç”¨ JpaRepository é è¨­ï¼‰</td>
              <td>åˆ†é¡ CRUD</td>
            </tr>
          </tbody>
        </table>

        <!-- ========== SECTION 11: MODEL è¨­è¨ˆè©³è§£ ========== -->
        <hr />
        <h2 id="sec-model-detail">11. Model è¨­è¨ˆè©³è§£</h2>
        <p>
          Model å±¤æ¡ç”¨ JPA + Lombokï¼Œä»¥ä¸‹èªªæ˜ POJO è¨­è¨ˆåŸå› èˆ‡ Annotation ä½¿ç”¨ã€‚
        </p>

        <h3>11.1 User å¯¦é«”</h3>
        <pre><code class="language-java">@Entity
@Table(name = "users")
@Data @NoArgsConstructor @AllArgsConstructor
public class User { ... }</code></pre>
        <table>
          <thead>
            <tr>
              <th>æ¬„ä½</th>
              <th>å‹åˆ¥</th>
              <th>è¨­è¨ˆåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>userId</td>
              <td>Long</td>
              <td>è‡ªå‹•éå¢ä¸»éµï¼Œé¿å… UUID æ•ˆèƒ½å•é¡Œ</td>
            </tr>
            <tr>
              <td>email</td>
              <td>String(100)</td>
              <td>ç™»å…¥è­˜åˆ¥ç¬¦ï¼Œunique ç´„æŸé˜²é‡è¤‡</td>
            </tr>
            <tr>
              <td>password</td>
              <td>String(255)</td>
              <td>å„²å­˜ BCrypt é›œæ¹Šå€¼ï¼ˆ60 å­—å…ƒï¼‰ï¼Œé ç•™ç©ºé–“</td>
            </tr>
            <tr>
              <td>role</td>
              <td>Enum</td>
              <td>MEMBER/ADMINï¼Œå‹åˆ¥å®‰å…¨æ›¿ä»£ Magic String</td>
            </tr>
            <tr>
              <td>isDeleted</td>
              <td>Boolean</td>
              <td>è»Ÿåˆªé™¤æ¨™è¨˜ï¼Œä¿ç•™æ­·å²è¨‚å–®é—œè¯</td>
            </tr>
            <tr>
              <td>deletedAt</td>
              <td>LocalDateTime</td>
              <td>åˆªé™¤æ™‚é–“æˆ³è¨˜ï¼Œç”¨æ–¼ audit trail</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>@Enumerated(EnumType.STRING)</strong>ï¼šEnum
          å­˜ç‚ºå­—ä¸²ï¼ˆ"MEMBER"/"ADMIN"ï¼‰è€Œéæ•¸å­—ï¼Œå¯è®€æ€§é«˜ä¸”é˜²æ­¢é †åºæ”¹è®Šé€ æˆè³‡æ–™éŒ¯äº‚ã€‚
        </p>

        <h3>11.2 Product å¯¦é«”</h3>
        <pre><code class="language-java">@Entity
@Table(name = "products", indexes = {
    @Index(name = "idx_category_listed", columnList = "category_id, is_listed"),
    @Index(name = "idx_name", columnList = "name"),
    @Index(name = "idx_created_at", columnList = "created_at")
})</code></pre>
        <table>
          <thead>
            <tr>
              <th>ç´¢å¼•</th>
              <th>è¨­è¨ˆåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>idx_category_listed</td>
              <td>å„ªåŒ–åˆ†é¡ç¯©é¸ + ä¸Šæ¶ç‹€æ…‹æŸ¥è©¢</td>
            </tr>
            <tr>
              <td>idx_name</td>
              <td>å„ªåŒ–å•†å“åç¨±æœå°‹</td>
            </tr>
            <tr>
              <td>idx_created_at</td>
              <td>å„ªåŒ–æ™‚é–“æ’åº</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>orphanRemoval = true</strong>ï¼šç•¶ Product åˆªé™¤æ™‚ï¼Œé€£å¸¶åˆªé™¤æ‰€æœ‰
          ProductVariantã€‚
        </p>

        <h3>11.3 Order å¯¦é«”</h3>
        <pre><code class="language-java">public enum OrderStatus {
    PENDING, PAID, SHIPPED, COMPLETED, CANCELLED
}</code></pre>
        <p>
          <strong>ç‹€æ…‹æ©Ÿè¨­è¨ˆ</strong>ï¼šPENDING â†’ PAID â†’ SHIPPED â†’ COMPLETED /
          CANCELLED
        </p>
        <table>
          <thead>
            <tr>
              <th>æ¬„ä½</th>
              <th>è¨­è¨ˆåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>totalAmount</td>
              <td>è¨‚å–®ç¸½é‡‘é¡å¿«ç…§ï¼Œä¸å—å•†å“åƒ¹æ ¼è®Šå‹•å½±éŸ¿</td>
            </tr>
            <tr>
              <td>paymentNote</td>
              <td>éŠ€è¡Œè½‰å¸³å¾Œ 5 ç¢¼ï¼Œä¾›äººå·¥æ ¸å°</td>
            </tr>
            <tr>
              <td>recipientName/Phone/Address</td>
              <td>æ”¶ä»¶äººè³‡è¨Šï¼Œèˆ‡ç”¨æˆ¶è³‡æ–™åˆ†é›¢ï¼ˆå¯ä»£æ”¶ï¼‰</td>
            </tr>
          </tbody>
        </table>

        <h3>11.4 å…¶ä»–å¯¦é«”è¨­è¨ˆè¦é»</h3>
        <table>
          <thead>
            <tr>
              <th>å¯¦é«”</th>
              <th>è¨­è¨ˆè¦é»</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ProductVariant</td>
              <td>UniqueConstraint(product_id, color, size) é˜²æ­¢é‡è¤‡è¦æ ¼</td>
            </tr>
            <tr>
              <td>CartItem</td>
              <td>UniqueConstraint(user_id, variant_id) é˜²æ­¢åŒè¦æ ¼é‡è¤‡åŠ å…¥</td>
            </tr>
            <tr>
              <td>OrderItem</td>
              <td>price æ¬„ä½ç‚ºä¸‹å–®æ™‚åƒ¹æ ¼å¿«ç…§</td>
            </tr>
            <tr>
              <td>ContactMessage</td>
              <td>ipAddress æ¬„ä½è¨˜éŒ„ IPv4/IPv6ï¼ˆé•·åº¦ 45ï¼‰</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>@PrePersist</strong>ï¼šæ‰€æœ‰å¯¦é«”åœ¨ INSERT å‰è‡ªå‹•å¡«å…¥
          <code>createdAt</code>ï¼Œç¢ºä¿ audit ä¸€è‡´æ€§ã€‚
        </p>

        <!-- ========== SECTION 12: DTO è½‰æ›è©³è§£ ========== -->
        <hr />
        <h2 id="sec-dto-detail">12. DTO è½‰æ›è©³è§£</h2>
        <p>
          DTO å±¤è² è²¬å‰å¾Œç«¯å‘½åè§£è€¦èˆ‡è³‡æ–™éæ¿¾ï¼Œæ‰€æœ‰ DTO éƒ½æœ‰
          <code>fromEntity()</code> å’Œ <code>fromEntities()</code> éœæ…‹æ–¹æ³•ã€‚
        </p>

        <h3>12.1 ProductDTO</h3>
        <table>
          <thead>
            <tr>
              <th>å¾Œç«¯æ¬„ä½</th>
              <th>å‰ç«¯æ¬„ä½</th>
              <th>è½‰æ›é‚è¼¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>productId</td>
              <td>id</td>
              <td>å‘½åè¦ç¯„çµ±ä¸€</td>
            </tr>
            <tr>
              <td>imageUrl</td>
              <td>image</td>
              <td>å‘½åè¦ç¯„çµ±ä¸€</td>
            </tr>
            <tr>
              <td>category.name</td>
              <td>category</td>
              <td>å±•é–‹é—œè¯ç‚ºå­—ä¸²</td>
            </tr>
            <tr>
              <td>category.categoryId</td>
              <td>categoryId</td>
              <td>ä¿ç•™ ID ä¾›ç¯©é¸</td>
            </tr>
            <tr>
              <td>variants.stock.sum()</td>
              <td>stock</td>
              <td>èšåˆæ‰€æœ‰è¦æ ¼åº«å­˜</td>
            </tr>
          </tbody>
        </table>

        <h3>12.2 OrderDTO</h3>
        <p>
          å«å·¢ç‹€ <code>OrderItemDTO</code>ï¼Œè¨ˆç®—æ¯é …å°è¨ˆ
          <code>subtotal = price Ã— quantity</code>ã€‚
        </p>

        <h3>12.3 CartItemDTO</h3>
        <p>
          ä¸‰å±¤å·¢ç‹€çµæ§‹ï¼šCartItemDTO â†’ VariantInfo â†’
          ProductInfoï¼Œæä¾›å®Œæ•´è³¼ç‰©è»Šè³‡è¨Šã€‚
        </p>

        <!-- ========== SECTION 13: CONFIG é…ç½®è©³è§£ ========== -->
        <hr />
        <h2 id="sec-config-detail">13. Config é…ç½®è©³è§£</h2>

        <h3>13.1 SecurityConfig</h3>
        <table>
          <thead>
            <tr>
              <th>Bean/è¨­å®š</th>
              <th>å¯¦ä½œåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>corsConfigurationSource()</td>
              <td>CORS ç™½åå–®ï¼Œæ”¯æ´ Cookie è·¨åŸŸ</td>
            </tr>
            <tr>
              <td>securityFilterChain()</td>
              <td>è·¯ç”±æ¬Šé™é…ç½® + JWT Filter è¨»å†Š</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>å…¬é–‹è·¯ç”±</strong>ï¼š<code>/api/auth/**</code>ã€GET
          <code>/api/products/**</code>ã€GET
          <code>/api/categories/**</code>ã€POST <code>/api/inquiries</code>
        </p>

        <h3>13.2 DataInitializer</h3>
        <p>
          å¯¦ä½œ <code>CommandLineRunner</code>ï¼Œå•Ÿå‹•æ™‚è‡ªå‹•å»ºç«‹é è¨­
          Adminï¼ˆadmin@choose.com / 123456ï¼‰ã€‚
        </p>

        <h3>13.3 PasswordConfig</h3>
        <p>
          ç¨ç«‹é…ç½®é¡åˆ¥ï¼Œé¿å… SecurityConfig å¾ªç’°ä¾è³´ã€‚æä¾›
          <code>BCryptPasswordEncoder</code> Beanã€‚
        </p>

        <h3>13.4 CloudinaryConfig</h3>
        <p>
          å¾ç’°å¢ƒè®Šæ•¸è®€å– <code>CLOUDINARY_*</code> é…ç½®ï¼Œåˆå§‹åŒ– Cloudinary SDKã€‚
        </p>

        <h3>13.5 WebConfig</h3>
        <p>ç›®å‰ç©ºå¯¦ä½œï¼ŒCORS å·²ç§»è‡³ SecurityConfigï¼ˆé¿å…é‡è¤‡æ¨™é ­ï¼‰ã€‚</p>

        <!-- ========== SECTION 14: SECURITY å®‰å…¨è©³è§£ ========== -->
        <hr />
        <h2 id="sec-security-detail">14. Security å®‰å…¨è©³è§£</h2>

        <h3>14.1 JwtUtil</h3>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>å¯¦ä½œåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>generateToken()</td>
              <td>ç”¢ç”Ÿ JWTï¼ŒåŒ…å« userId/email/role</td>
            </tr>
            <tr>
              <td>extractEmail()</td>
              <td>å¾ Token æå– emailï¼ˆsubjectï¼‰</td>
            </tr>
            <tr>
              <td>extractUserId()</td>
              <td>å¾ Token æå– userIdï¼ˆcustom claimï¼‰</td>
            </tr>
            <tr>
              <td>extractRole()</td>
              <td>å¾ Token æå– roleï¼ˆcustom claimï¼‰</td>
            </tr>
            <tr>
              <td>validateToken()</td>
              <td>é©—è­‰ç°½ç«  + éæœŸæ™‚é–“</td>
            </tr>
            <tr>
              <td>isTokenExpired()</td>
              <td>æª¢æŸ¥æ˜¯å¦éæœŸ</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>HMAC-SHA256 ç°½ç« </strong>ï¼šä½¿ç”¨
          <code>Keys.hmacShaKeyFor()</code> ç”¢ç”Ÿç°½ç« é‡‘é‘°ã€‚
        </p>

        <h3>14.2 JwtAuthenticationFilter</h3>
        <p>ç¹¼æ‰¿ <code>OncePerRequestFilter</code>ï¼Œæ¯å€‹è«‹æ±‚åŸ·è¡Œä¸€æ¬¡ã€‚</p>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>å¯¦ä½œåŸå› </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>doFilterInternal()</td>
              <td>ä¸»è¦éæ¿¾é‚è¼¯</td>
            </tr>
            <tr>
              <td>extractJwtFromCookie()</td>
              <td>å„ªå…ˆå¾ Cookie å–å¾— Token</td>
            </tr>
            <tr>
              <td>extractJwtFromHeader()</td>
              <td>å›é€€è‡³ Authorization Headerï¼ˆç›¸å®¹æ€§ï¼‰</td>
            </tr>
          </tbody>
        </table>
        <p>
          <strong>èªè­‰æµç¨‹</strong>ï¼šæå– Token â†’ é©—è­‰ â†’ æŸ¥è©¢ç”¨æˆ¶ â†’ å»ºç«‹
          Authentication â†’ æ³¨å…¥ SecurityContextã€‚
        </p>

        <!-- ========== SECTION 15: COMMON å…±ç”¨è©³è§£ ========== -->
        <hr />
        <h2 id="sec-common-detail">15. Common å…±ç”¨è©³è§£</h2>

        <h3>15.1 ApiResponse&lt;T&gt;</h3>
        <pre><code class="language-java">public class ApiResponse&lt;T&gt; {
    private boolean success;
    private String message;
    private T data;
}</code></pre>
        <table>
          <thead>
            <tr>
              <th>æ–¹æ³•</th>
              <th>ç”¨é€”</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>success(data)</td>
              <td>æ¨™æº–æˆåŠŸå›æ‡‰</td>
            </tr>
            <tr>
              <td>success(msg, data)</td>
              <td>å«è¨Šæ¯çš„æˆåŠŸå›æ‡‰</td>
            </tr>
            <tr>
              <td>error(msg)</td>
              <td>æ¨™æº–éŒ¯èª¤å›æ‡‰</td>
            </tr>
          </tbody>
        </table>

        <h3>15.2 GlobalExceptionHandler</h3>
        <pre><code class="language-java">@RestControllerAdvice
public class GlobalExceptionHandler { ... }</code></pre>
        <table>
          <thead>
            <tr>
              <th>ä¾‹å¤–é¡å‹</th>
              <th>HTTP Status</th>
              <th>å ´æ™¯</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>MethodArgumentNotValidException</td>
              <td>400</td>
              <td>Bean Validation å¤±æ•—</td>
            </tr>
            <tr>
              <td>IllegalArgumentException</td>
              <td>400</td>
              <td>æ¥­å‹™é‚è¼¯é©—è­‰å¤±æ•—</td>
            </tr>
            <tr>
              <td>EntityNotFoundException</td>
              <td>404</td>
              <td>è³‡æºä¸å­˜åœ¨</td>
            </tr>
            <tr>
              <td>AccessDeniedException</td>
              <td>403</td>
              <td>æ¬Šé™ä¸è¶³</td>
            </tr>
            <tr>
              <td>BadCredentialsException</td>
              <td>401</td>
              <td>ç™»å…¥å¤±æ•—</td>
            </tr>
            <tr>
              <td>NoHandlerFoundException</td>
              <td>404</td>
              <td>è·¯ç”±ä¸å­˜åœ¨</td>
            </tr>
            <tr>
              <td>RuntimeException</td>
              <td>500</td>
              <td>ç³»çµ±éŒ¯èª¤</td>
            </tr>
            <tr>
              <td>Exception</td>
              <td>500</td>
              <td>å…œåº•è™•ç†</td>
            </tr>
          </tbody>
        </table>

        <!-- ========== SECTION 16: å±¤ç´šå”ä½œé—œä¿‚åœ– ========== -->
        <hr />
        <h2 id="sec-collaboration">16. å±¤ç´šå”ä½œé—œä¿‚åœ–</h2>
        <div class="diagram-box">
          <div class="diagram-title">Layer Collaboration</div>
          <div class="mermaid" id="diagram-collaboration"></div>
        </div>
        <p><strong>å”ä½œèªªæ˜</strong>ï¼š</p>
        <ul>
          <li><strong>Controller â†’ Service</strong>ï¼šèª¿ç”¨æ¥­å‹™é‚è¼¯</li>
          <li><strong>Service â†’ Repository</strong>ï¼šè³‡æ–™å­˜å–</li>
          <li><strong>Repository â†’ Model</strong>ï¼šORM æ˜ å°„</li>
          <li><strong>Controller/Service â†’ DTO</strong>ï¼šè³‡æ–™è½‰æ›</li>
          <li>
            <strong>Security â†’ Service</strong>ï¼šç”¨æˆ¶é©—è­‰éœ€æŸ¥è©¢ UserService
          </li>
          <li>
            <strong>Config â†’ Security</strong>ï¼šSecurityConfig è¨»å†Š
            JwtAuthenticationFilter
          </li>
          <li>
            <strong>Common â†’ Controller</strong>ï¼šApiResponse +
            GlobalExceptionHandler
          </li>
        </ul>
      </article>
    </div>

    <!-- Back to Top Button -->
    <button
      class="back-to-top"
      id="backToTop"
      onclick="scrollToTop()"
      title="å›åˆ°é ‚éƒ¨"
    >
      â†‘
    </button>

    <!-- DIAGRAM TEMPLATES -->
    <script type="text/template" id="tpl-layered">
      flowchart TB
          subgraph Client
              Browser[Vue 3 Frontend]
          end
          subgraph Security["Security Layer (2)"]
              Filter[JwtAuthenticationFilter]
              Util[JwtUtil]
          end
          subgraph Presentation["Controller Layer (9)"]
              C[REST Controllers]
          end
          subgraph Business["Service Layer (7)"]
              S[Business Services]
          end
          subgraph Persistence["Repository Layer (7)"]
              R[JpaRepository]
          end
          subgraph Database["Database"]
              DB[(MySQL)]
          end
          Browser -- "HTTP + JWT Cookie" --> Filter
          Filter -- "è§£æ Token" --> Util
          Util -- "é©—è­‰ç°½ç« " --> Filter
          Filter -- "æ³¨å…¥ SecurityContext" --> C
          C -- "@Valid é©—è­‰" --> C
          C -- "èª¿ç”¨æ¥­å‹™" --> S
          S -- "@Transactional" --> S
          S -- "Entity æ“ä½œ" --> R
          R --> DB
    </script>

    <script type="text/template" id="tpl-auth">
      sequenceDiagram
          participant B as Browser
          participant F as JwtFilter
          participant U as JwtUtil
          participant S as UserService
          participant C as Controller
          B->>F: HTTP Request (Cookie: auth_token)
          F->>F: å¾ Cookie / Header æå– Token
          F->>U: validateToken(token)
          U-->>F: Claims (userId, email, role)
          F->>S: findByEmail(email)
          S-->>F: User Entity
          F->>F: å»ºç«‹ Authentication
          F->>F: SecurityContextHolder.setContext()
          F->>C: æ”¾è¡Œè«‹æ±‚
          C->>C: @AuthenticationPrincipal User
          C-->>B: ApiResponse JSON
    </script>

    <script type="text/template" id="tpl-order">
      sequenceDiagram
          autonumber
          participant FE as Frontend
          participant C as OrderController
          participant S as OrderService
          participant R as Repository
          participant DB as MySQL
          FE->>C: POST /api/orders
          C->>S: createOrder(userId, Order)
          activate S
          Note over S: @Transactional é–‹å•Ÿäº¤æ˜“
          loop æ¯é … OrderItem
              S->>R: findVariantById(id)
              R->>DB: SELECT * FROM product_variants
              DB-->>R: Variant (å« stock)
              S->>S: é©—è­‰ stock >= quantity
              alt åº«å­˜ä¸è¶³
                  S-->>C: throw IllegalArgumentException
                  Note over S: è‡ªå‹• Rollback
              end
              S->>R: variant.setStock(stock - qty)
              R->>DB: UPDATE product_variants
          end
          S->>R: save(Order + OrderItems)
          R->>DB: INSERT INTO orders, order_items
          deactivate S
          S-->>C: æˆåŠŸå›å‚³ Order
          C->>C: è½‰æ›ç‚º OrderDTO
          C-->>FE: 201 Created
    </script>

    <script type="text/template" id="tpl-collaboration">
      flowchart LR
          subgraph Presentation
              C[Controller]
          end
          subgraph Business
              S[Service]
          end
          subgraph Persistence
              R[Repository]
          end
          subgraph Domain
              M[Model]
          end
          subgraph CrossCutting["Cross-Cutting Concerns"]
              DTO[DTO]
              SEC[Security]
              CFG[Config]
              COM[Common]
          end
          C --> S
          S --> R
          R --> M
          C --> DTO
          S --> DTO
          SEC --> S
          CFG --> SEC
          COM --> C
    </script>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.4.0/mermaid.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
      mermaid.initialize({
        startOnLoad: false,
        theme: "default",
        securityLevel: "loose",
      });
      async function startRendering() {
        setTimeout(hideLoading, 4000);
        try {
          hljs.highlightAll();
          const diagrams = [
            { tpl: "tpl-layered", target: "diagram-layered" },
            { tpl: "tpl-auth", target: "diagram-auth" },
            { tpl: "tpl-order", target: "diagram-order" },
            { tpl: "tpl-collaboration", target: "diagram-collaboration" },
          ];
          for (const item of diagrams) {
            const source = document.getElementById(item.tpl).innerHTML.trim();
            document.getElementById(item.target).textContent = source;
          }
          await mermaid.run({ nodes: document.querySelectorAll(".mermaid") });
          hideLoading();
        } catch (err) {
          console.error("Render error:", err);
          hideLoading();
        }
      }
      function hideLoading() {
        const loader = document.getElementById("loading");
        if (loader) {
          loader.style.opacity = "0";
          setTimeout(() => (loader.style.display = "none"), 500);
        }
      }
      window.onload = startRendering;

      // Back to Top functionality
      const backToTopBtn = document.getElementById("backToTop");
      window.addEventListener("scroll", function () {
        if (window.scrollY > 500) {
          backToTopBtn.classList.add("visible");
        } else {
          backToTopBtn.classList.remove("visible");
        }
      });
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
    </script>
  </body>
</html>
